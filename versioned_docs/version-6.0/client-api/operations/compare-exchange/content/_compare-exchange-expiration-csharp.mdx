import Admonition from '@theme/Admonition';
import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';
import CodeBlock from '@theme/CodeBlock';

<Admonition type="note" title="">

* Compare exchange value expiration works very similar to [document expiration](../../../../server/extensions/expiration.mdx).  

* Use the `@expires` field in a [compare exchange value's metadata](../../../../client-api/operations/compare-exchange/compare-exchange-metadata.mdx) to schedule its expiration.  

* In this page:
  * [Syntax](../../../../client-api/operations/compare-exchange/compare-exchange-expiration.mdx#syntax)
  * [Examples](../../../../client-api/operations/compare-exchange/compare-exchange-expiration.mdx#examples)

</Admonition>
## Syntax

`@expires` is a metadata property that holds a `DateTime` value. Once the 
specified date and time has passed, the compare exchange value is set for 
deletion by the expiration feature. The _exact_ time this happens depends 
on the expiration frequency and other 
[expiration configurations](../../../../server/extensions/expiration.mdx#configuring-the-expiration-feature).  

To set a compare exchange value to expire, simply put a `DateTime` value 
(in UTC format) in the `@expires` field, then to send it to the server.  



## Examples

Creating a new key with `CreateCompareExchangeValue()`:

<TabItem value="expiration_0" label="expiration_0">
<CodeBlock language="csharp">
{`using (IAsyncDocumentSession session = store.OpenAsyncSession())
\{
    // Set a time exactly one week from now
    DateTime expirationTime = DateTime.UtcNow.AddDays(7);

    // Create a new compare exchange value
    var cmpxchgValue = session.Advanced.ClusterTransaction.CreateCompareExchangeValue("key", "value");

    // Edit Metadata
    cmpxchgValue.Metadata[Constants.Documents.Metadata.Expires] = expirationTime;

    // Send to server
    session.SaveChangesAsync();
\}
`}
</CodeBlock>
</TabItem>

Updating an existing key with `PutCompareExchangeValueOperation<T>`:

<TabItem value="expiration_1" label="expiration_1">
<CodeBlock language="csharp">
{`// Retrieve an existing key
CompareExchangeValue<string> cmpxchgValue = store.Operations.Send(
        new GetCompareExchangeValueOperation<string>("key"));
                
// Set time
DateTime expirationTime = DateTime.UtcNow.AddDays(7);

// Edit Metadata
cmpxchgValue.Metadata[Constants.Documents.Metadata.Expires] = expirationTime;
                
// Update value. Index must match the index on the server side,
// or the operation will fail.
CompareExchangeResult<string> result = store.Operations.Send(
        new PutCompareExchangeValueOperation<string>(
            cmpxchgValue.Key,
            cmpxchgValue.Value,
            cmpxchgValue.Index));
`}
</CodeBlock>
</TabItem>




