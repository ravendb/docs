import Admonition from '@theme/Admonition';
import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';
import CodeBlock from '@theme/CodeBlock';

<Admonition type="note" title="">

* The Session [tracks all changes](../../../../client-api/session/what-is-a-session-and-how-does-it-work.mdx#tracking-changes) 
  made to all the entities it has either loaded, stored, deleted, or queried for,  
  and persists to the server only what is needed when `saveChanges()` is called.

* You can use the session's advanced `getTrackedEntities()` method  
  to retrieve the **list of all entities tracked by the session**.

* To check what is the actual type of change made to the entities, see:  
  [Get entity changes](../../../../client-api/session/how-to/check-if-entity-has-changed.mdx#get-entity-changes), or
  [Get session changes](../../../../client-api/session/how-to/check-if-there-are-any-changes-on-a-session.mdx#get-session-changes).
 
* In this page:
  * [Get tracked entities](../../../../client-api/session/how-to/get-tracked-entities.mdx#get-tracked-entities)
  * [Syntax](../../../../client-api/session/how-to/get-tracked-entities.mdx#syntax)

</Admonition>
## Get tracked entities 

**Tracking stored entities**:
<TabItem value="get_tracked_entities_1" label="get_tracked_entities_1">
<CodeBlock language="js">
{`const session = documentStore.openSession();

// Store entities within the session:
let employee1 = new Employee();
employee.firstName = "John";
employee.lastName = "Doe";
await session.store(employee, "employees/1-A");

let employee2 = new Employee();
employee.firstName = "David";
employee.lastName = "Brown";
await session.store(employee2, "employees/2-A");

let employee3 = new Employee();
employee.firstName = "Tom";
employee.lastName = "Miller";
await session.store(employee3, "employees/3-A");

// Get tracked entities:
let trackedEntities = session.advanced.getTrackedEntities();

// The session tracks the new stored entities:
const entityInfo = trackedEntities["employees/1-A"];
assert.equal(entityInfo.id, "employees/1-A");
assert.ok(entityInfo.entity instanceof Employee);

// Save changes:
await session.saveChanges();

// The session keeps tracking the entities even after SaveChanges is called:
trackedEntities = session.advanced.getTrackedEntities();
`}
</CodeBlock>
</TabItem>

**Tracking loaded and deleted entities**:
<TabItem value="get_tracked_entities_2" label="get_tracked_entities_2">
<CodeBlock language="js">
{`const session = documentStore.openSession();

// Load entity:
const employee1 = await session.load("employees/1-A");

// Delete entity:
session.delete("employees/3-A");

// Get tracked entities:
const trackedEntities = session.advanced.getTrackedEntities();

// The session tracks the 2 entities:

// The loaded entity:
const entityInfo1 = trackedEntities["employees/1-A"];
assert.ok(!entityInfo1.isDeleted);

// The deleted entity:
const entityInfo2 = trackedEntities.get("employees/3-A");
assert.ok(entityInfo2.isDeleted);

// Save changes:
await session.saveChanges();
`}
</CodeBlock>
</TabItem>

**Tracking queried entities**:
<TabItem value="get_tracked_entities_3" label="get_tracked_entities_3">
<CodeBlock language="js">
{`const session = documentStore.openSession();

// Query for all employees:
const employees = await session.query(\{ collection: "employees"\}).all();

// Get tracked entities:
const trackedEntities = session.advanced.getTrackedEntities();

// The session tracks the entities loaded via the query:
const entityInfo1 = trackedEntities[employees[0].id];
const entityInfo2 = trackedEntities[employees[1].id];
`}
</CodeBlock>
</TabItem>



## Syntax

<TabItem value="syntax_1" label="syntax_1">
<CodeBlock language="js">
{`getTrackedEntities();
`}
</CodeBlock>
</TabItem>

| Return value              |                                                                  |
|---------------------------|------------------------------------------------------------------|
| `Map<string, EntityInfo>` | A dictionary that maps the entity id to the `EntityInfo` object. |

<TabItem value="syntax_2" label="syntax_2">
<CodeBlock language="js">
{`class EntityInfo \{
    // The tracked entity id
    id;       // string
    
    // The tracked entity object
    entity;   // object
    
    // isDeleted is true if entity was deleted
    isDeleted // boolean
\}
`}
</CodeBlock>
</TabItem>




