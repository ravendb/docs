import Admonition from '@theme/Admonition';
import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';
import CodeBlock from '@theme/CodeBlock';
import ContentFrame from '@site/src/components/ContentFrame';
import Panel from '@site/src/components/Panel';

<Admonition type="note" title="">

* This article describes how to revert specific documents to **specific revisions**.  
  To revert documents from all collections (or from selected collections) to a **specific point in time**,  
  see [Revert documents to specific time](../../../../document-extensions/revisions/revert-documents-to-revisions/revert-documents-to-specific-time.mdx). 

* In this article:  
  * [Overview](../../../../document-extensions/revisions/revert-documents-to-revisions/revert-documents-to-specific-revisions.mdx#overview)
  * [Revert documents](../../../../document-extensions/revisions/revert-documents-to-revisions/revert-documents-to-specific-revisions.mdx#revert-documents)
    * [Revert single document](../../../../document-extensions/revisions/revert-documents-to-revisions/revert-documents-to-specific-revisions.mdx#revert-single-document)
    * [Revert multiple documents](../../../../document-extensions/revisions/revert-documents-to-revisions/revert-documents-to-specific-revisions.mdx#revert-multiple-documents)
  * [Syntax](../../../../document-extensions/revisions/revert-documents-to-revisions/revert-documents-to-specific-revisions.mdx#syntax)  

</Admonition>

<Panel heading="Overview">
    
* When reverting to a specific revision,
  the document content will be overwritten by the content of the specified revision.

* Reverting a document to a specific revision can be executed even if the revisions configuration is disabled:
  * **When revisions are ENABLED**:  
    Reverting the document creates a new revision containing the content of the target revision.  
  * **When revisions are DISABLED**:  
    The document is reverted to the target revision without creating a new revision.  

* In addition to the document itself, reverting will impact _Document Extensions_ as follows:  
  * **Attachments**:  
    If the target revision owns attachments, they are restored to their state when the revision was created.  
  * **Counters**:  
    If the target revision owns counters, they are restored to functionality with their values at the time the revision was created.  
  * **Time series**:  
    Time series data is Not reverted. Learn more in [Revisions and time series](../../../../document-extensions/revisions/revisions-and-other-features.mdx#reverted-data-1).
    
</Panel>

<Panel heading="Revert documents">
    
* You can revert single or multiple documents to specific revisions using the `RevertRevisionsByIdOperation` operation.

* By default, the operation will be applied to the [default database](../../../../client-api/setting-up-default-database.mdx).  
  To operate on a different database, see [switch operations to different database](../../../../client-api/operations/how-to/switch-operations-to-a-different-database.mdx).
    
* To revert a document to a specific revision, provide the document ID and the change-vector of the target revision to the `RevertRevisionsByIdOperation` operation.  
  The document content will be overwritten by the content of the specified revision.

* An exception will be thrown if the revision's change-vector is not found, does not exist for the specified document, or belongs to a different document.
    
* When executing this operation on a document that had revisions and was deleted, placing it in the Revisions Bin,  
  the document will be **recreated** with the content of the specified target revision and will be removed from the Revisions Bin.

---

### How to obtain a revision's change-vector:  

The change-vector of a revision can be obtained via:  

  * The Client API - follow the code in the examples [below](../../../document-extensions/revisions/revert-documents-to-revisions/revert-documents-to-specific-revisions#revert-single-document)  
  * Or from the document view in the Studio  

![Get revision CV](../assets/get-cv-for-revision.png)

1. Go to the Revisions tab in the document view.
2. Click a revision to view
3. The document view will display the content of the revision.  
   This top label indicates that you are viewing a revision and not the current document.
4. Click the copy button in the Properties pane to copy this revision's change-vector to your clipboard.

</Panel>

<Panel heading="Revert single document">

Using RavenDB's sample data, document _orders/1-A_ has a total of 7 revisions.  
In this example, we revert document _orders/1-A_ to its very first revision.

<Tabs groupId='languageSyntax'>
<TabItem value="Sync" label="Sync">
```csharp
using (var session = store.OpenSession())
{
    // Get the revisions metadata for the document you wish to revert
    // ==============================================================
    
    var revisionsMetadata = session.Advanced.Revisions
        .GetMetadataFor(id: "orders/1-A");

    // Get the change-vector of the revision you wish to revert to:
    // ============================================================
    
    // Note: revisionsMetadata[0] is the latest revision,
    // so specify the index of the revision you want.
    // In this example, it will be the very first revision of the document:
    
    var numberOfRevisions = revisionsMetadata.Count();
    var revisionChangeVector = revisionsMetadata[numberOfRevisions-1]
        .GetString(Constants.Documents.Metadata.ChangeVector);

    // Execute the operation
    store.Operations.Send(
        // Pass the document ID and the change-vector of the revision to revert to
        new RevertRevisionsByIdOperation("orders/1-A", revisionChangeVector));
}
```
</TabItem>
<TabItem value="Async" label="Async">
```csharp
using (var asyncSession = store.OpenAsyncSession())
{
    // Get the revisions metadata for the document you wish to revert
    // ==============================================================
    
    var revisionsMetadata = await asyncSession.Advanced.Revisions
        .GetMetadataForAsync(id: "Orders/1-A");
    
    // Get the change-vector of the revision you wish to revert to:
    // ============================================================
    
    // Note: revisionsMetadata[0] is the latest revision,
    // so specify the index of the revision you want.
    // In this example, it will be the very first revision of the document:
    
    var numberOfRevisions = revisionsMetadata.Count();
    var revisionChangeVector = revisionsMetadata[numberOfRevisions-1]
        .GetString(Constants.Documents.Metadata.ChangeVector);

    // Execute the operation
    await store.Operations.SendAsync(
        // Pass the document ID and the change-vector of the revision to revert to
        new RevertRevisionsByIdOperation("Orders/1-A", revisionChangeVector));
}
```
</TabItem>
</Tabs>

</Panel>

<Panel heading="Revert multiple documents">

You can use the operation to revert multiple documents.  
Note: The documents do not need to belong to the same collection.

<Tabs groupId='languageSyntax'>
<TabItem value="Sync" label="Sync">
```csharp
using (var session = store.OpenSession())
{
    // Get the revisions metadata for the documents you wish to revert
    var revisionsMetadata1 = session.Advanced.Revisions
        .GetMetadataFor(id: "orders/1-A");
    var revisionsMetadata2 = session.Advanced.Revisions
        .GetMetadataFor(id: "users/999");

    // Get the change-vector of the revisions you wish to revert to
    var changeVector1 = revisionsMetadata1[2]
        .GetString(Constants.Documents.Metadata.ChangeVector);
    var changeVector2 = revisionsMetadata1[3]
        .GetString(Constants.Documents.Metadata.ChangeVector);

    // Execute the operation
    store.Operations.Send(
        // Pass the document IDs and the change-vector of the revisions to revert to
        new RevertRevisionsByIdOperation(new Dictionary<string, string>()
            { { "orders/1-A", changeVector1 }, { "users/999", changeVector2 } }));
}
```
</TabItem>
<TabItem value="Async" label="Async">
```csharp
using (var asyncSession = store.OpenAsyncSession())
{
    // Get the revisions metadata for the documents you wish to revert
    var revisionsMetadata1 = await asyncSession.Advanced.Revisions
        .GetMetadataForAsync(id: "orders/1-A");
    var revisionsMetadata2 = await asyncSession.Advanced.Revisions
        .GetMetadataForAsync(id: "users/999");

    // Get the change-vector of the revisions you wish to revert to
    var changeVector1 = revisionsMetadata1[2]
        .GetString(Constants.Documents.Metadata.ChangeVector);
    var changeVector2 = revisionsMetadata1[3]
        .GetString(Constants.Documents.Metadata.ChangeVector);

    // Execute the operation
    await store.Operations.SendAsync(
        // Pass the document IDs and the change-vector of the revisions to revert to
        new RevertRevisionsByIdOperation(new Dictionary<string, string>()
            { { "orders/1-A", changeVector1 }, { "users/999", changeVector2 } }));
}
```
</TabItem>
</Tabs>

</Panel>

<Panel heading="Syntax">
    
### `RevertRevisionsByIdOperation`
    
<TabItem value="" label="">
```csharp
Available overloads:
====================
public RevertRevisionsByIdOperation(string id, string cv);
public RevertRevisionsByIdOperation(Dictionary<string, string> idToChangeVector);
```
</TabItem>

| Parameter            | Type                         | Description                                                                                                                                 |
|----------------------|------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------|
| **id**               | `string`                     | The ID of the document to revert.                                                                                                           |
| **cv**               | `string`                     | The change-vector of the revision to which the document should be reverted.                                                                 |
| **idToChangeVector** | `Dictionary<string, string>` | A dictionary where each key is a document ID, and each value is the change-vector of the revision to which the document should be reverted. |
    
</Panel>