import Admonition from '@theme/Admonition';
import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';
import CodeBlock from '@theme/CodeBlock';

<Admonition type="note" title="">

* Detailed **query statistics** can be retrieved for every executed query using the `Statistics` method.  
  
* Stats such as query duration, number of results, index name used in the query, and more,  
  are returned in the `QueryStatistics` object.

* `Statistics` should be called on the **final query object that is executed/materialized** (e.g. by calling `ToList`, `ToListAsync`, `First`, `FirstOrDefault`, etc.). If you convert between query types (e.g. `ToDocumentQuery()`, `ToAsyncDocumentQuery()`, `ToQueryable()`), a new query object may be created and previously-requested statistics will **not** be carried over. In such cases, the original `stats` variable will remain with its default values.
* In This Page:  
   * [Get query statistics](../../../client-api/session/querying/how-to-get-query-statistics.mdx#get-query-statistics)  
   * [Syntax](../../../client-api/session/querying/how-to-get-query-statistics.mdx#syntax)  

</Admonition>
## Get query statistics

<Tabs groupId='languageSyntax'>
<TabItem value="Query" label="Query">
<CodeBlock language="csharp">
{`List<Employee> employees = session
    .Query<Employee>()
    .Where(x => x.FirstName == "Anne")
     // Get query stats:
     // * Call 'Statistics'
     // * Pass an out 'QueryStatistics' param for getting the stats
    .Statistics(out QueryStatistics stats)
    .ToList();

long numberOfResults = stats.TotalResults; // Get results count
long queryDuration = stats.DurationInMs;   // Get query duration
string indexNameUsed = stats.IndexName;    // Get index name used in query
// ...
`}
</CodeBlock>
</TabItem>
<TabItem value="Query_async" label="Query_async">
<CodeBlock language="csharp">
{`List<Employee> employees = await asyncSession
    .Query<Employee>()
    .Where(x => x.FirstName == "Anne")
     // Get query stats:
     // * Call 'Statistics'
     // * Pass an out 'QueryStatistics' param for getting the stats
    .Statistics(out QueryStatistics stats)
    .ToListAsync();

long numberOfResults = stats.TotalResults; // Get results count
long queryDuration = stats.DurationInMs;   // Get query duration
string indexNameUsed = stats.IndexName;    // Get index name used in query
// ...
`}
</CodeBlock>
</TabItem>
<TabItem value="DocumentQuery" label="DocumentQuery">
<CodeBlock language="csharp">
{`List<Employee> employees = session.Advanced
    .DocumentQuery<Employee>()
    .WhereEquals(x => x.FirstName, "Anne")
     // Get query stats:
     // * Call 'Statistics'
     // * Pass an out 'QueryStatistics' param for getting the stats
    .Statistics(out QueryStatistics stats)
    .ToList();

long numberOfResults = stats.TotalResults; // Get results count
long queryDuration = stats.DurationInMs;  // Get query duration
string indexNameUsed = stats.IndexName;   // Get index name used in query
// ...
`}
</CodeBlock>
</TabItem>
<TabItem value="RQL" label="RQL">
<CodeBlock language="sql">
{`from "Employees" where FirstName == "Anne"
`}
</CodeBlock>
</TabItem>
</Tabs>



## Syntax

<TabItem value="syntax_1" label="syntax_1">
<CodeBlock language="csharp">
{`IRavenQueryable<T> Statistics(out QueryStatistics stats);
`}
</CodeBlock>
</TabItem>

| Parameter | Type              | Description                                     |
|-----------|-------------------|-------------------------------------------------|
| **stats** | `QueryStatistics` | An 'out' param for getting the query statistics |

<br/> 

<TabItem value="syntax_2" label="syntax_2">
<CodeBlock language="csharp">
{`public class QueryStatistics
\{
    public bool IsStale \{ get; set; \}
    public long DurationInMs \{ get; set; \}
    public long TotalResults \{ get; set; \}
    public long SkippedResults \{ get; set; \}
    public long? ScannedResults \{ get; set; \}
    public DateTime Timestamp \{ get; set; \}
    public string IndexName \{ get; set; \}
    public DateTime IndexTimestamp \{ get; set; \}
    public DateTime LastQueryTime \{ get; set; \}
    public long? ResultEtag \{ get; set; \}
    public string NodeTag \{ get; set; \}
\}
`}
</CodeBlock>
</TabItem>

| Property           | Type             | Description                                                                                                                                                                                                  |
|--------------------|------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| **IsStale**        | `bool`           | Are the results returned by the query potentially stale                                                                                                                                                      |
| **DurationInMs**   | `long`           | Query duration on the server side in Milliseconds                                                                                                                                                            |
| **TotalResults**   | `long`           | The total count of results that matched the query as `Int32`.<br/>Matching query results can also be counted as `Int32` using [Count](../../../client-api/session/querying/how-to-count-query-results.mdx#count). |
| **SkippedResults** | `long`           | The number of results skipped by the server.<br/>Learn more in [paging through tampered results](../../../indexes/querying/paging.mdx#paging-through-tampered-results).                                           |
| **ScannedResults** | `long?`          | The number of results scanned by the query.<br/>Relevant only when using a filter clause in the query.                                                                                                        |
| **Timestamp**      | `DateTime`       | The time when the query results were unstale                                                                                                                                                                 |
| **IndexName**      | `string`         | The name of the queried index                                                                                                                                                                                |
| **IndexTimestamp** | `IndexTimestamp` | The timestamp of the queried index                                                                                                                                                                           |
| **LastQueryTime**  | `DateTime`       | The timestamp of the last time the index was queried                                                                                                                                                         |
| **ResultEtag**     | `long?`          | Results Etag                                                                                                                                                                                                 |
| **NodeTag**        | `string`         | Tag of the cluster node that responded to the query                                                                                                                                                          |




