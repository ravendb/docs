---
title: "Attachments and Other Features"
sidebar_label: "Attachments and Other Features"
sidebar_position: 7
---

import Admonition from '@theme/Admonition';
import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';
import CodeBlock from '@theme/CodeBlock';
import LanguageSwitcher from "@site/src/components/LanguageSwitcher";
import LanguageContent from "@site/src/components/LanguageContent";
import ContentFrame from '@site/src/components/ContentFrame';
import Panel from '@site/src/components/Panel';

<Admonition type="note" title="">

* Once an attachment is added to a document, the `@attachments` property is added to the document’s metadata with details about the attachment.
    
* This metadata update triggers any features that respond to document changes -  
  such as [Indexing](../../studio/database/indexes/indexes-overview),
  any defined [ongoing tasks](../../studio/database/tasks/ongoing-tasks/general-info),
  [Subscriptions](../../client-api/data-subscriptions/what-are-data-subscriptions), etc.
 
* In this article:
  * [Attachments & Replication](../../document-extensions/attachments/attachments-and-other-features#attachments-replication)  
  * [Attachments & RavenDB ETL](../../document-extensions/attachments/attachments-and-other-features#attachments-ravendb-etl)
  * [Attachments & Export/import/backup/restore](../../document-extensions/attachments/attachments-and-other-features#attachments-exportimportbackuprestore)
  * [Attachments & Revisions](../../document-extensions/attachments/attachments-and-other-features#attachments-revisions)
    
</Admonition>

<Panel heading="Attachments & Replication">
    
Replication is triggered by document changes, including when attachments are added or modified.  
* **Internal replication** occurs automatically between nodes in the database group.    
* **External replication** is a defined ongoing task between two RavenDB databases (typically across clusters).
    
Learn more about replication in [Replication overview](../../server/clustering/replication/replication-overview).    
    
---
    
For both internal and external replication:
 
**Local attachments**:  
The document is replicated along with the attachment's binary content, which will be stored on the target node.

**Remote attachments**:  
The document is replicated without the binary content, only the metadata is transferred.  
The attachment's content resides in shared remote storage (e.g., S3, Azure Blob) and does not need to be copied between nodes.

  * **Target server compatibility**:  
    If the target node is running a RavenDB server version earlier than `7.2`, which does not support remote attachments,  
    replicating a document that references a remote attachment will throw a `LegacyReplicationViolationException`.

  *  **Remote destination configuration for external replication**:  
    When using external replication, the remote storage destinations must also be configured on the target database.  
    This is your responsibility, RavenDB does not automatically replicate the remote attachment configurations.  
    If the destination is not defined on the target, the remote attachment will be inaccessible after replication.
 
</Panel>

<Panel heading="Attachments & RavenDB ETL">  

A [RavenDB ETL task](../../server/ongoing-tasks/etl/raven) sends documents to another RavenDB database and allows you to transform documents using a script.
The ETL task is triggered by document changes in the source database, including when attachments are added or modified.
    
---
    
**Local attachments**:  
The document is sent to the target database along with the binary attachment stream.

**Remote attachments**:  
The document is sent without the binary stream, only the metadata is transferred, since the attachment content resides in remote storage.

  * **Remote destination configuration**:  
    When documents that reference remote attachments are sent via RavenDB ETL, you must ensure that the same remote attachment configuration is defined on the target database.
    This is your responsibility, as the ETL process does not automatically configure remote destinations on the target side.
  
  * **Target server compatibility**:    
    If the target node is running a RavenDB server version earlier than `7.2`, which does not support remote attachments, 
    attempting to send a document that references a remote attachment will result in an excetion.
    
</Panel>

<Panel heading="Attachments & Export/import/backup/restore">
    
The following behavior applies to [Export](../../studio/database/tasks/export-database),
[Import](../../studio/database/tasks/import-data/import-data-file), 
[Backup](../../studio/database/tasks/backup-task),
and [Restore from backup](../../studio/database/create-new-database/from-backup) operations:
    
**Local attachments**:  
The binary content is included in the operation:  
  * During export/backup, the binary stream is written to the dump file.  
  * During import/restore, the binary stream is loaded from the dump into the database.  

**Remote attachments**:  
Only the metadata is included in the operation:  
  * During export/backup, only the metadata is written to the dump, the binary content remains in remote storage.
  * During import/restore, the metadata is loaded from the dump into the database, the content is expected to remain accessible in its original remote location.    
  * **Remote destination configuration** for import & restore:  
    If remote attachments are included, the same remote storage destinations must be configured in the target database.  
    This is your responsibility, RavenDB does not automatically transfer remote destination configurations as part of these operations.  

</Panel>

<Panel heading="Attachments & Revisions">

Revisions are immutable snapshots of a document's state at a given point in time.
If [Document revisions](../../document-extensions/revisions/overview) are enabled, any addition or removal of attachments will create a new revision of the document.

---
        
When a revision is created, it records the attachment's state exactly as it was at that moment.  
The storage location of the attachment is bound to the revision’s creation context, not to the current state of the document:  
* If the attachment was **local**, the revision stores it as local.
* If the attachment was **remote**, the revision stores only the remote parameters (e.g., destination identifier, upload time).
    
The background process that uploads attachments to remote storage only processes current documents.  
It does not process or modify revisions.    
  * Revisions that reference an attachment as local will remain local forever, even if the attachment in the current (parent) document is
    [scheduled for remote uploading](../../document-extensions/attachments/store-attachments/store-attachments-remote#schedule-existing-attachments-for-remote-upload) and later uploaded to remote storage.
  * The binary content will be retained on disk until all references to the attachments are removed -  
    both from the parent document and from any revision that still reference it.
    
**Restoring from a Revision**:  
Reverting a document to a previous revision also restores the attachment state stored in that revision:  
  * Reverting to a revision that references a local attachmet restores the attachment as local.
  * Reverting to a revision that references a remote attachment results in a document with a remote attachment.
    
</Panel>