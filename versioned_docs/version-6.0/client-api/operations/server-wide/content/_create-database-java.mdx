import Admonition from '@theme/Admonition';
import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';
import CodeBlock from '@theme/CodeBlock';

<Admonition type="note" title="">

* Use `CreateDatabaseOperation` to create a new database from the **Client API**, as described below.  
  To create a new database from the **Studio**, see [Create database](../../../studio/database/create-new-database/general-flow.mdx).

* This operation requires a client certificate with a security clearance of _Operator_ or _ClusterAdmin_.  
  To learn which operations are allowed at each level, see [Security clearance and permissions](../../../server/security/authorization/security-clearance-and-permissions.mdx).

* In this article:
    * [Create new database](../../../client-api/operations/server-wide/create-database.mdx#create-new-database)
        * [Example I - Create database](../../../client-api/operations/server-wide/create-database.mdx#example-i---create-non-sharded-database)
        * [Example II - Ensure database does not exist before creating](../../../client-api/operations/server-wide/create-database.mdx#example-ii---ensure-database-does-not-exist-before-creating)
    * [Syntax](../../../client-api/operations/server-wide/create-database.mdx#syntax)

</Admonition>
## Create new database

<Admonition type="note" title="">

##### Example I - Create database
* The following simple example creates a non-sharded database with the default replication factor of 1.

<TabItem value="CreateDatabase" label="CreateDatabase">
<CodeBlock language="java">
{`DatabaseRecord databaseRecord = new DatabaseRecord();
databaseRecord.setDatabaseName("MyNewDatabase");
store.maintenance().server().send(new CreateDatabaseOperation(databaseRecord));
`}
</CodeBlock>
</TabItem>

</Admonition>
<Admonition type="note" title="">

##### Example II - Ensure database does not exist before creating
* To ensure the database does not already exist before creating it, follow this example:

<TabItem value="EnsureDatabaseExists" label="EnsureDatabaseExists">
<CodeBlock language="java">
{`public void ensureDatabaseExists(IDocumentStore store, String database, boolean createDatabaseIfNotExists) \{
    database = ObjectUtils.firstNonNull(database, store.getDatabase());

    if (StringUtils.isBlank(database)) \{
        throw new IllegalArgumentException("Value cannot be null or whitespace");
    \}

    try \{
        store.maintenance().forDatabase(database).send(new GetStatisticsOperation());
    \} catch (DatabaseDoesNotExistException e) \{
        if (!createDatabaseIfNotExists) \{
            throw e;
        \}

        try \{
            DatabaseRecord databaseRecord = new DatabaseRecord();
            databaseRecord.setDatabaseName(database);
            store.maintenance().server().send(new CreateDatabaseOperation(databaseRecord));
        \} catch (ConcurrencyException ce) \{
            // The database was already created before calling CreateDatabaseOperation
        \}
    \}
\}
`}
</CodeBlock>
</TabItem>

</Admonition>


## Syntax

<TabItem value="create_database_syntax" label="create_database_syntax">
<CodeBlock language="java">
{`public CreateDatabaseOperation(DatabaseRecord databaseRecord)

public CreateDatabaseOperation(DatabaseRecord databaseRecord, int replicationFactor)
`}
</CodeBlock>
</TabItem>

| Parameter             | Type           | Description                                                                                                                                                                                                                                              |
|-----------------------|----------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| **databaseRecord**    | DatabaseRecord | Instance of `DatabaseRecord` containing database configuration.                                                                                                                                                                                          |
| **replicationFactor** | int            | Number of nodes the database should be replicated to.<br/><br/>If not specified, the value is taken from `topology.replicationFactor`,<br/>or defaults to **`1`** if that is not set.<br/><br/>If `topology` is provided, the `replicationFactor` is ignored. |

## DatabaseRecord

`DatabaseRecord` is a collection of database configurations.  

| constructor                           | Description                      |
|---------------------------------------|----------------------------------|
| DatabaseRecord(`string` databaseName) | Initialize a new database record |

<Admonition type="info" title="">

**Note:**

* Only the properties listed in the table below can be configured in the `DatabaseRecord` object passed to `CreateDatabaseOperation`.
* For example, although ongoing task definitions are public on the _DatabaseRecord_ class, setting them during database creation will result in an exception.
  To define ongoing tasks (e.g., backups, ETL, replication), use the appropriate dedicated operation after the database has been created.

</Admonition>

| Property                           | Type                                         | Description                                                                                                                                                                                                                                                                 |
|------------------------------------|----------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| **analyzers**                      | `Map<String, AnalyzerDefinition>`            | A dictionary defining the [Custom Analyzers](../../../indexes/using-analyzers.mdx#creating-custom-analyzers) available to the database.                                                                                                                                         |
| **autoIndexes**                    | `Map<String, AutoIndexDefinition>`           | Auto-index definitions for the database.                                                                                                                                                                                                                                    |
| **client**                         | `ClientConfiguration`                        | [Client behavior](../../../studio/server/client-configuration.mdx) configuration.                                                                                                                                                                                               |
| **conflictSolverConfig**           | `ConflictSolver`                             | Define the strategy used to resolve [Replication conflicts](../../../server/clustering/replication/replication-conflicts.mdx).                                                                                                                                                  |
| **dataArchival**                   | `DataArchivalConfiguration`                  | [Data Archival](../../../server/extensions/archival.mdx) configuration for the database.                                                                                                                                                                                        |
| **databaseName**                   | `String`                                     | The database name.                                                                                                                                                                                                                                                          |
| **disabled**                       | `boolean` (default: false)                   | Set the database initial state.<br/> `true` - disable the database.<br/> `false` - (default) the database will be enabled.<br/><br/>This can be modified later via [ToggleDatabasesStateOperation](../../../client-api/operations/server-wide/toggle-databases-state.mdx).          |
| **documentsCompression**           | `DocumentsCompressionConfiguration`          | Configuration settings for [Compressing documents](../../../server/storage/documents-compression.mdx).                                                                                                                                                                          |
| **elasticSearchConnectionStrings** | `Map<String, ElasticSearchConnectionString>` | Define [ElasticSearch Connection Strings](../../../client-api/operations/maintenance/connection-strings/add-connection-string.mdx#add-an-elasticsearch-connection-string), keyed by name.                                                                                       |
| **encrypted**                      | `boolean` (default: false)                   | `true` - create an [Encrypted database](../../../server/security/encryption/database-encryption.mdx).<br/><br/>Note: Use `PutSecretKeyCommand` to send your secret key to the server BEFORE creating the database.<br/><br/>`false` - (default) the database will not be encrypted. |
| **expiration**                     | `ExpirationConfiguration`                    | [Expiration](../../../server/extensions/expiration.mdx) configuration for the database.                                                                                                                                                                                         |
| **indexes**                        | `Map<String, IndexDefinition>`               | Define [Indexes](../../../client-api/operations/maintenance/indexes/put-indexes.mdx) that will be created with the database - <br/>no separate deployment needed.                                                                                                                |
| **integrations**                   | `IntegrationConfigurations`                  | Configuration for [Integrations](../../../integrations/postgresql-protocol/overview.mdx),<br/>e.g. `PostgreSqlConfiguration`.                                                                                                                                                    |
| **lockMode**                       | `DatabaseLockMode`                           | Set the database lock mode.<br/>(default: `Unlock`)<br/><br/>This can be modified later via `SetDatabasesLockOperation`.                                                                                                                                                       |
| **olapConnectionStrings**          | `Map<String, OlapConnectionString>`          | Define [OLAP Connection Strings](../../../client-api/operations/maintenance/connection-strings/add-connection-string.mdx#add-an-olap-connection-string), keyed by name.                                                                                                         |
| **queueConnectionStrings**         | `Map<String, QueueConnectionString>`         | Define [Queue Connection Strings](../../../server/ongoing-tasks/etl/queue-etl/overview.mdx), keyed by name.                                                                                                                                                                     |
| **ravenConnectionStrings**         | `Map<String, RavenConnectionString>`         | Define [Raven Connection Strings](../../../client-api/operations/maintenance/connection-strings/add-connection-string.mdx#add-a-ravendb-connection-string), keyed by name.                                                                                                      |
| **refresh**                        | `RefreshConfiguration`                       | [Refresh](../../../server/extensions/refresh.mdx) configuration for the database.                                                                                                                                                                                               |
| **revisions**                      | `RevisionsConfiguration`                     | [Revisions](../../../document-extensions/revisions/client-api/operations/configure-revisions.mdx) configuration for the database.                                                                                                                                               |
| **revisionsForConflicts**          | `RevisionsCollectionConfiguration`           | Set the revisions configuration for conflicting documents.                                                                                                                                                                                                                  |
| **rollingIndexes**                 | `Map<String, RollingIndex>`                  | Dictionary mapping index names to their deployment configurations.                                                                                                                                                                                                          |
| **settings**                       | `Map<String, String>`                        | [Configuration](../../../server/configuration/configuration-options.mdx) settings for the database.                                                                                                                                                                             |
| **sharding**                       | `ShardingConfiguration`                      | The sharding configuration.                                                                                                                                                                                                                                                 |
| **sorters**                        | `Map<String, SorterDefinition>`              | A dictionary defining the [Custom Sorters](../../../studio/database/settings/custom-sorters.mdx) available to the database.                                                                                                                                                     |
| **sqlConnectionStrings**           | `Map<String, SqlConnectionString>`           | Define [SQL Connection Strings](../../../client-api/operations/maintenance/connection-strings/add-connection-string.mdx#add-an-sql-connection-string), keyed by name.                                                                                                           |
| **studio**                         | `StudioConfiguration`                        | [Studio Configuration](../../../studio/database/settings/studio-configuration.mdx).                                                                                                                                                                                             |
| **timeSeries**                     | `TimeSeriesConfiguration`                    | [Time series](../../../studio/database/settings/time-series-settings.mdx) configuration for the database.                                                                                                                                                                       |
| **topology**                       | `DatabaseTopology`                           | Optional topology configuration.<br/><br/>Defaults to `null`, in which case the server will determine which nodes to place the database on, based on the specified `ReplicationFactor`.                                                                                       |
| **unusedDatabaseIds**              | `Set<String>`                                | Set database IDs that will be excluded when creating new change vectors.                                                                                                                                                                                                    |




