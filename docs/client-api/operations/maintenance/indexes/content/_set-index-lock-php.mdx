import Admonition from '@theme/Admonition';
import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';
import CodeBlock from '@theme/CodeBlock';

<Admonition type="note" title="">

* The lock mode controls the behavior of index modifications.  
  Use `SetIndexesLockOperation` to modify the **lock mode** for a single index or multiple indexes.

* **Indexes scope**:  
  The lock mode can be set only for static-indexes, not for auto-indexes.

* **Nodes scope**:  
  The lock mode will be updated on all nodes in the database group.

* Setting the lock mode can also be done in the **Studio** [indexes list](../../../../studio/database/indexes/indexes-list-view.mdx#indexes-list-view---actions) view.  
  Locking an index is not a security measure, the index can be unlocked at any time.  

* In this page:
    * [Lock modes](../../../../client-api/operations/maintenance/indexes/set-index-lock.mdx#lock-modes)
    * [Sample usage flow](../../../../client-api/operations/maintenance/indexes/set-index-lock.mdx#sample-usage-flow)
    * [Set lock mode - single index](../../../../client-api/operations/maintenance/indexes/set-index-lock.mdx#set-lock-mode---single-index)
    * [Set lock mode - multiple indexes](../../../../client-api/operations/maintenance/indexes/set-index-lock.mdx#set-lock-mode---multiple-indexes)
    * [Syntax](../../../../client-api/operations/maintenance/indexes/set-index-lock.mdx#syntax)

</Admonition>
## Lock modes

* **Unlocked** - when lock mode is set using `unlock()`:  
  * Any change to the index definition will be applied.  
  * If the new index definition differs from the one stored on the server,  
    the index will be updated and the data will be re-indexed using the new index definition.
  * The index can be deleted.
 
* **Locked (ignore)** - when lock mode is set using `lockedIgnore()`:  
  * Index definition changes will Not be applied.  
  * Modifying the index definition will return successfully and no error will be raised,  
    however, no change will be made to the index definition on the server.
  * Trying to delete the index will not remove it from the server, and no error will be raised.
 
* **Locked (error)** - when lock mode is set using `lockedError()`:  
  * Index definitions changes will Not be applied.  
  * An exception will be thrown upon trying to modify the index.
  * The index cannot be deleted. Attempting to do so will result in an exception.



## Sample usage flow

Consider the following scenario:

* Your client application defines and [deploys a static-index](../../../../client-api/operations/maintenance/indexes/put-indexes.mdx) upon application startup.
  
* After the application has started, you make a change to your index definition and re-indexing occurs.   
  However, if the index lock mode is `unlock`, the next time your application will start,  
  it will reset the index definition back to the original version.

* Locking the index allows to make changes to the running index and prevents the application  
  from setting it back to the previous definition upon startup. See the following steps:  
<br/>

  1. Run your application  
  2. Modify the index definition on the server (from Studio, or from another application),  
     and then set this index lock mode to `lockedIgnore`.  
  3. A side-by-side replacement index is created on the server.  
     It will index your dataset according to the **new** definition.  
  4. At this point, if any instance of your original application is started,  
     the code that defines and deploys the index upon startup will have no effect  
     since the index is locked.  
  5. Once the replacement index is done indexing, it will replace the original index.  



## Set lock mode - single index

<TabItem value="set_lock_single" label="set_lock_single">
<CodeBlock language="php">
{`// Define the set lock mode operation
// Pass index name & lock mode
$setLockModeOp = new SetIndexesLockOperation("Orders/Totals", IndexLockMode::lockedIgnore());

// Execute the operation by passing it to Maintenance.Send
// An exception will be thrown if index does not exist
$store->maintenance()->send($setLockModeOp);

// Lock mode is now set to 'LockedIgnore'
// Any modifications done now to the index will Not be applied, and will Not throw
`}
</CodeBlock>
</TabItem>



## Set lock mode - multiple indexes

<TabItem value="set_lock_multiple" label="set_lock_multiple">
<CodeBlock language="php">
{`// Define the index list and the new lock mode:
$parameters = new IndexLockParameters();
$parameters->setIndexNames([ "Orders/Totals", "Orders/ByCompany" ]);
$parameters->setMode(IndexLockMode::lockedError());

// Define the set lock mode operation, pass the parameters
$setLockModeOp = new SetIndexesLockOperation($parameters);

// Execute the operation by passing it to Maintenance.Send
// An exception will be thrown if any of the specified indexes do not exist
$store->maintenance()->send($setLockModeOp);

// Lock mode is now set to 'LockedError' on both indexes
// Any modifications done now to either index will throw
`}
</CodeBlock>
</TabItem>



## Syntax

<TabItem value="syntax_1" label="syntax_1">
<CodeBlock language="php">
{`// Available overloads:
SetIndexesLockOperation(?string $indexName, ?IndexLockMode $mode);
SetIndexesLockOperation(?Parameters $parameters);
`}
</CodeBlock>
</TabItem>

| Parameters | Type | Description |
|- | - | - |
| **$mode** | `?IndexLockMode` | Lock mode to set |
| **$indexName** | `?string` | Index names to set lock mode for |
| **$parameters** | `?Parameters` | Index lock parameters |

<TabItem value="syntax_2" label="syntax_2">
<CodeBlock language="php">
{`class IndexLockMode
\{
    public static function unlock(): IndexLockMode;
    public static function lockedIgnore(): IndexLockMode
    public static function lockedError(): IndexLockMode;

    public function isUnlock(): bool;
    public function isLockedIgnore(): bool;
    public function isLockedError(): bool;
\}
`}
</CodeBlock>
</TabItem>





