import Admonition from '@theme/Admonition';
import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';
import CodeBlock from '@theme/CodeBlock';

<Admonition type="note" title="">

* Given a string term, the Suggestion feature will offer __similar terms__ from your data.

* Word similarities are found using string distance algorithms.

* Examples in this article demonstrate getting suggestions with a __dynamic-query__.  
  For getting suggestions with an __index-query__ see [query for suggestions with index](../../../indexes/querying/suggestions.mdx).
* In this page:

    * Overview:
        * [What are terms](../../../client-api/session/querying/how-to-work-with-suggestions.mdx#what-are-terms)
        * [When to use suggestions](../../../client-api/session/querying/how-to-work-with-suggestions.mdx#when-to-use-suggestions)
      
    * Examples:
        * [Suggest terms - for single term](../../../client-api/session/querying/how-to-work-with-suggestions.mdx#suggest-terms---for-single-term)
        * [Suggest terms - for multiple terms](../../../client-api/session/querying/how-to-work-with-suggestions.mdx#suggest-terms---for-multiple-terms)
        * [Suggest terms - for multiple fields](../../../client-api/session/querying/how-to-work-with-suggestions.mdx#suggest-terms---for-multiple-fields)
        * [Suggest terms - customize options and display name](../../../client-api/session/querying/how-to-work-with-suggestions.mdx#suggest-terms---customize-options-and-display-name)
      
    * [The auto-index terms in Studio](../../../client-api/session/querying/how-to-work-with-suggestions.mdx#the-auto-index-terms-in-studio)
    * [Syntax](../../../client-api/session/querying/how-to-work-with-suggestions.mdx#syntax)

</Admonition>
## What are terms

* All queries in RavenDB use an index - learn more about that [here](../../../client-api/session/querying/how-to-query.mdx#queries-always-provide-results-using-an-index).  
  Whether making a dynamic query which generates an auto-index or using a static index,  
  the data from your documents is 'broken' into __terms__ that are kept in the index.  

* This tokenization process (what terms will be generated) depends on the analyzer used,    
  various analyzers differ in the way they split the text stream. Learn more in [Analyzers](../../../indexes/using-analyzers.mdx).

* The terms can then be queried to retrieve matching documents that contain them.



## When to use suggestions

Querying for suggestions is useful in the following scenarios:

  * __When query has no results__:

      * When searching for documents that match some condition on a given string term,  
        if the term is misspelled then you will Not get any results.  
        You can then ask RavenDB to suggest similar terms that do exist in the index.

      * The suggested terms can then be used in a new query to retrieve matching documents,  
        or simply presented to the user asking what they meant to query.

  * __When looking for alternative terms__:

      * When simply searching for additional alternative terms for a term that does exist.  

<Admonition type="warning" title="">

The resulting suggested terms will Not include the term for which you search,  
they will only contain the similar terms.

</Admonition>



## Suggest terms - for single term

Consider this example:  
Based on the __Northwind sample data__, the following query has no resulting documents,  
as no document in the Products collection contains the term `chaig` in its `Name` field.

<TabItem value="suggest_1" label="suggest_1">
<CodeBlock language="js">
{`// This dynamic query on the 'Products' collection has NO resulting documents
const products = await session
    .query(\{ collection: "Products" \})
    .whereEquals("Name", "Chai")
    .all();
`}
</CodeBlock>
</TabItem>

* Executing the above query will generate the auto-index `Auto/Products/ByName`.  
  This auto-index will contain a list of all available terms from the document field `Name`.  
  The generated terms are visible in the Studio - see image [below](../../../client-api/session/querying/how-to-work-with-suggestions.mdx#the-auto-index-terms-in-studio).

* If you suspect that the term `chaig` in the query criteria is written incorrectly,   
  you can ask RavenDB to suggest __existing terms__ that are similar to `chaig`, as follows:.  

<Tabs groupId='languageSyntax'>
<TabItem value="Query" label="Query">
<CodeBlock language="js">
{`// Query for suggested terms for single term:
// ==========================================

const suggestions = await session
     // Make a dynamic query on collection 'Products'
    .query({ collection: "Products" })
     // Call 'suggestUsing'
    .suggestUsing(x => x
         // Request to get terms from field 'Name' that are similar to 'chaig' 
        .byField("Name", "chaig"))
    .execute();
`}
</CodeBlock>
</TabItem>
<TabItem value="RQL" label="RQL">
<CodeBlock language="sql">
{`// Query for terms from field 'Name' that are similar to 'chaig'
from "Products"
select suggest(Name, "chaig")
`}
</CodeBlock>
</TabItem>
</Tabs>

<TabItem value="suggest_3" label="suggest_3">
<CodeBlock language="js">
{`// The resulting suggested terms:
// ==============================

console.log("Suggested terms in field 'Name' that are similar to 'chaig':");
suggestions["Name"].suggestions.forEach(suggestedTerm => \{
    console.log("\\t" + suggestedTerm);
\});

// Suggested terms in field 'Name' that are similar to 'chaig':
//     chai
//     chang
`}
</CodeBlock>
</TabItem>



## Suggest terms - for multiple terms

<Tabs groupId='languageSyntax'>
<TabItem value="Query" label="Query">
<CodeBlock language="js">
{`// Query for suggested terms for multiple terms:
// =============================================

const suggestions = await session
     // Make a dynamic query on collection 'Products'
    .query({ collection: "Products" })
     // Call 'suggestUsing'
    .suggestUsing(x => x
         // Request to get terms from field 'Name' that are similar to 'chaig' OR 'tof' 
        .byField("Name", ["chaig", "tof"]))
    .execute();
`}
</CodeBlock>
</TabItem>
<TabItem value="RQL" label="RQL">
<CodeBlock language="sql">
{`// Query for terms from field 'Name' that are similar to 'chaig' OR 'tof'
from "Products" select suggest(Name, $p0)
{ "p0" : ["chaig", "tof"] }
`}
</CodeBlock>
</TabItem>
</Tabs>

<TabItem value="suggest_5" label="suggest_5">
<CodeBlock language="js">
{`// The resulting suggested terms:
// ==============================

// Suggested terms in field 'Name' that are similar to 'chaig' OR to 'tof':
//     chai
//     chang
//     tofu
`}
</CodeBlock>
</TabItem>



## Suggest terms - for multiple fields

<Tabs groupId='languageSyntax'>
<TabItem value="Query" label="Query">
<CodeBlock language="js">
{`// Query for suggested terms in multiple fields:
// =============================================

const suggestions = await session
     // Make a dynamic query on collection 'Companies'
    .query({ collection: "Companies" })
     // Call 'suggestUsing' to get suggestions for terms that are 
     // similar to 'chop-soy china' in first document field (e.g. 'Name') 
    .suggestUsing(x => x
        .byField("Name", "chop-soy china"))
     // Call 'AndSuggestUsing' to get suggestions for terms that are 
     // similar to 'maria larson' in an additional field (e.g. 'Contact.Name')
    .andSuggestUsing(x => x
        .byField("Contact.Name", "maria larson"))
    .execute();
`}
</CodeBlock>
</TabItem>
<TabItem value="RQL" label="RQL">
<CodeBlock language="sql">
{`// Query for suggested terms from field 'Name' and field 'Contact.Name'
from "Companies"
select suggest(Name, "chop-soy china"), suggest(Contact.Name, "maria larson")
`}
</CodeBlock>
</TabItem>
</Tabs>

<TabItem value="suggest_7" label="suggest_7">
<CodeBlock language="js">
{`// The resulting suggested terms:
// ==============================

// Suggested terms in field 'Name' that is similar to 'chop-soy china':
//     chop-suey chinese

// Suggested terms in field 'Contact.Name' that are similar to 'maria larson':
//     maria larsson
//     marie bertrand
//     aria cruz
//     paula wilson
//     maria anders
`}
</CodeBlock>
</TabItem>



## Suggest terms - customize options and display name

<Tabs groupId='languageSyntax'>
<TabItem value="Query" label="Query">
<CodeBlock language="js">
{`// Query for suggested terms - customize options and display name:
// ===============================================================

const suggestions = await session
     // Make a dynamic query on collection 'Products'
    .query({ collection: "Products" })
     // Call 'suggestUsing'
    .suggestUsing(x => x
        .byField("Name", "chaig")
         // Customize suggestions options
        .withOptions({
            accuracy: 0.4,
            pageSize: 5,
            distance: "JaroWinkler",
            sortMode: "Popularity"
        })
         // Customize display name for results
        .withDisplayName("SomeCustomName"))
    .execute();
`}
</CodeBlock>
</TabItem>
<TabItem value="RQL" label="RQL">
<CodeBlock language="sql">
{`// Query for suggested terms - customize options and display name
from "Products"
select suggest(
    Name,
    'chaig',
    '{ "Accuracy" : 0.4, "PageSize" : 5, "Distance" : "JaroWinkler", "SortMode" : "Popularity" }'
) as "SomeCustomName"
`}
</CodeBlock>
</TabItem>
</Tabs>

<TabItem value="suggest_9" label="suggest_9">
<CodeBlock language="js">
{`// The resulting suggested terms:
// ==============================

console.log("Suggested terms:");
// Results are available under the custom name entry
suggestions["SomeCustomName"].suggestions.forEach(suggestedTerm => \{
    console.log("\\t" + suggestedTerm);
\});

// Suggested terms:
//     chai
//     chang
//     chartreuse verte
`}
</CodeBlock>
</TabItem>



## The auto-index terms in Studio

Based on the Northwind sample data, these are the terms generated for index `Auto/Products/ByName`:

![Figure 1. Auto-index terms](./assets/auto-index-terms.png)

1. __The field name__ - derived from the document field that was used in the dynamic-query.  
   In this example the field name is `Name`.

2. __The terms__ generated from the data that the Products collection documents have in their `Name` field.



## Syntax

__Suggest using__:

<TabItem value="syntax_1" label="syntax_1">
<CodeBlock language="js">
{`// Requesting suggestions for term(s) in a field: 
suggestUsing(action);

// Requesting suggestions for term(s) in another field in the same query:
andSuggestUsing(action);
`}
</CodeBlock>
</TabItem>

| Parameter   | Type                | Description                                                                     |
|-------------|---------------------|---------------------------------------------------------------------------------|
| __action__  | `(builder) => void` | Builder function with a fluent API that constructs a `SuggestionBase` instance. |

__Builder operations__:

<TabItem value="syntax_2" label="syntax_2">
<CodeBlock language="js">
{`byField(fieldName, term);
byField(fieldName, terms);

withDisplayName(displayName);
withOptions(options);
`}
</CodeBlock>
</TabItem>

| Parameter       | Type       | Description                                                                                        |
|-----------------|------------|----------------------------------------------------------------------------------------------------|
| __fieldName__   | `string`   | The index field in which to search for similar terms                                               |
| __term__        | `string`   | The term for which to get suggested similar terms                                                  |
| __terms__       | `string[]` | List of terms for which to get suggested similar terms                                             |
| __displayName__ | `string`   | A custom name for the suggestions result (optional).                                               |
| __options__     | `object`   | Non-default suggestion options to use in the operation (optional).<br/>See available options below. |

__Suggestions options__:

| Option       | Type     | Description |
|--------------|----------|-------------|
| **pageSize** | `number` | <ul><li>Maximum number of suggested terms that will be returned.</li><li>Default is <strong>15</strong></li></ul> |
| **distance** | `string` | <ul><li>String distance algorithm to use.</li><li>`None` / `Levenshtein` / `JaroWinkler` / `NGram`</li><li>Default is <strong>Levenshtein</strong>.</li></ul> |
| **accuracy** | `number` | <ul><li>Suggestion accuracy.</li><li>Default is <strong>0.5</strong></li></ul> |
| **sortMode** | `string` | <ul><li>Indicates the order by which results are returned.</li><li>`None` / `Popularity`</li><li>Default is <strong>Popularity</strong>.</li></ul> |
