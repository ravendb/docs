import Admonition from '@theme/Admonition';
import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';
import CodeBlock from '@theme/CodeBlock';

<Admonition type="note" title="">

* **Custom compare-exchange items can be deleted**:  
  You can delete your own custom compare-exchange items.
  An item is deleted only if the index you provide in the request matches the current index stored on the server for the specified key.  
  
* **Delete items by expiration**:  
  Compare-exchange items can also be deleted by adding an expiration date to them.  
  Learn more in [Compare-exchange expiration](../compare-exchange/cmpxchg-expiration).
  
* **Compare-exchange tombstones**:  
  Whenever a compare-exchange item is deleted, a compare-exchange tombstone is created for it.  
  These tombstones are used to indicate to other RavenDB processes that the compare-exchange item was deleted,  
  so they can react accordingly.  
  For example, indexes referencing the deleted item will update themselves to remove those references.  
  Compare-exchange tombstones that are eligible for deletion are removed periodically by an internal cleanup task.  
  See: [Cluster.CompareExchangeTombstonesCleanupIntervalInMin](../compare-exchange/configuration#clustercompareexchangetombstonescleanupintervalinmin).

* <Admonition type="warning" title="">
  Do not attempt to delete [atomic guards](../compare-exchange/atomic-guards), which RavenDB uses internally to ensure ACID guarantees in cluster-wide transactions.
  These items are created automatically and must not be modified or removed.  
  
  If your custom compare-exchange item was set up to protect the consistency of a transaction, deleting it will break the ACID guarantees.
  Only delete or modify such items if you truly know what you're doing.    
  </Admonition>  
  
---

* In this article:  
  * [Delete compare-exchange item using a **cluster-wide session**](../compare-exchange/delete-cmpxchg-items#delete-compare-exchange-item-using-a-cluster-wide-session) 
    * [Delete by item](../compare-exchange/delete-cmpxchg-items#delete-by-item)  
    * [Delete by key and index](../compare-exchange/delete-cmpxchg-items#delete-by-key-and-index)  
  * [Delete compare-exchange items using the **Studio**](../compare-exchange/delete-cmpxchg-items#delete-compare-exchange-items-using-the-studio)
  * [Syntax](../compare-exchange/delete-cmpxchg-items#syntax)

</Admonition>

---

## Delete compare-exchange item using a cluster-wide session

* Delete compare-exchange items using a cluster-wide session when you want the deletion to be part of a transaction committed via `save_changes()`. 
  This is suitable if you want to include compare-exchange deletions alongside other operations, such as putting or deleting documents and compare-exchange items, in a single transaction.  
  Learn more about cluster-wide sessions in [Cluster transactions - overview](../client-api/session/cluster-transaction/overview).  

* Use `delete_compare_exchange_value()` to register the deletion of an existing compare-exchange item in the session.  
  The item will be deleted as part of the cluster-wide transaction when _save_changes()_ is called.

* If the item's index (its version) on the server is different from the index you provide, _save_changes()_ will throw a `ClusterTransactionConcurrencyException`.
  This means the item was modified by another operation after it was loaded into the session, and the entire transaction will be rejected.  

---

## Delete compare-exchange items using the Studio

You can delete one or multiple compare-exchange items from the Studio.

![The compare-exchange view](../assets/delete-cmpxchg.png)

1. Go to **Documents > Compare Exchange**.
2. Select the compare-exchange items you want to delete.  
3. Click **Delete**.

---

## Syntax

---

### `delete_compare_exchange_value`  
Delete compare-exchange item using cluster-wide session:

<TabItem value="" label="">
```csharp
// Available overloads:
session.advanced.cluster_transaction.delete_compare_exchange_value(item)
session.advanced.cluster_transaction.delete_compare_exchange_value(key, index)
```
</TabItem>

| Parameter | Type                      | Description |
|-----------|---------------------------|-------------|
| **item**  | `CompareExchangeValue[T]` | The compare-exchange item to delete.         |
| **key**   | `str`                     | The unique key of the compare-exchange item. |
| **index** | `int`                     | The current version of the item.<br/>Deletion will only succeed if this matches the version stored on the server. |
