import Admonition from '@theme/Admonition';
import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';
import CodeBlock from '@theme/CodeBlock';

<Admonition type="note" title="">

* When making a query, each document in the query results is assigned a **score**.  
  This score determines the order by which the documents come back in the results when requesting   
  to [order by score](../../../../client-api/session/querying/sort-query-results.mdx#order-by-score).

* Each document in the results includes this score under the `@index-score` property in its metadata.

* Use `include_explanations` to get the score details** and see how it was calculated.  

    <Admonition type="info" title="">
    * Including explanations is available only when using **Lucene** as the underlying search engine.
    * You can configure which search engine will be used. Learn how in [Selecting the search engine](../../../../indexes/search-engine/corax.mdx#selecting-the-search-engine).
    </Admonition>
* In this page:
    * [Include explanations in a query](../../../../client-api/session/querying/debugging/include-explanations.mdx#include-explanations-in-a-query)  
    * [View explanations](../../../../client-api/session/querying/debugging/include-explanations.mdx#view-explanations)  
    * [Syntax](../../../../client-api/session/querying/debugging/include-explanations.mdx#syntax)  

</Admonition>
## Include explanations in a query

<Tabs groupId='languageSyntax'>
<TabItem value="Query" label="Query">
<CodeBlock language="python">
{`# Prepare a callback
explanations_results: Optional[Explanations] = None

def explanations_callback(explanations: Explanations):
    explanations_results = explanations

# Query with 'document_query'

# Execute the query
results = list(
    # Prepare a query
    session.advanced.document_query(object_type=Product)
    # Call include_expirations, provide an out param for the explanations results
    .include_explanations()
    # Define query criteria
    # i.e. search for docs containing Syrup -or- Lager in their Name field
    .search("Name", "Syrup Lager")
)

# Get the score details for a specific document from the results
# Get explanations from the resulting Explanations object
score_details = explanations_results.explanations[results[0].Id]
`}
</CodeBlock>
</TabItem>
<TabItem value="RQL" label="RQL">
<CodeBlock language="sql">
{`from "Products"
where search(Name, "Syrup") or search(Name, "Lager")
include explanations()
`}
</CodeBlock>
</TabItem>
</Tabs>



## View explanations

* The detailed explanations can be viewed from the **Query view** in Studio.  

* Running a query with `include_explanations` will show an additional **Explanations Tab**.

![Figure 1. Explanations in the Studio](./assets/include-explanations-1.png)

* Sample score details:

![Figure 2. View explanations](./assets/include-explanations-2.png)



## Syntax

<TabItem value="syntax" label="syntax">
<CodeBlock language="python">
{`def include_explanations(
    self,
    options: Optional[ExplanationOptions] = None,
    explanations_callback: Callable[[Explanations], None] = None,
) -> DocumentQuery[_T]: ...
`}
</CodeBlock>
</TabItem>

| Parameter                 | Type                             | Description |
|---------------------------|----------------------------------|-------------|
| **explanations_callback** | `Callable[[Explanations], None]` | <ul><li>A callback function (action) that takes `Explanations` as an argument. It will be called by the client with the resulting `Explanations`.</li><li>You can interact with the resulting `Explanations` inside your callback.</li></ul> |
| **options** (Optional)    | `ExplanationOptions`             | Can be a `group_key` string. |

| `Explanations`         | Description |
|------------------------|-------------|
| `Dict[str, List[str]]` | <ul><li>Pass the resulting document ID for which to get score details.</li><li>Returns a list with all explanations.</li></ul> |
