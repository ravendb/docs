import Admonition from '@theme/Admonition';
import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';
import CodeBlock from '@theme/CodeBlock';

<Admonition type="note" title="">
    
* Use `PutCompareExchangeValueOperation` to **update the _value_ and/or _metadata_** of an existing compare-exchange item.
  This operation is also used to create new compare-exchange items, see [Create compare-exchange item](../compare-exchange/create-cmpxchg-items).

* To perform an update, provide:
  * The existing key
  * A new value and/or metadata
  * The latest index (version) of the item as last seen by the client.

* The update will succeed only if the index you provide exactly matches the current index stored on the server for that key.
  This ensures that the item hasn’t been modified by another client since you last read it.

* If the index does not match, or if the specified key does not exist:
  * The item is not updated.
  * No exception is thrown.
  * The operation result has `Successful = false`.
  
* If the update is successful:
  * The value and/or metadata are updated.
  * The server increments the index number of the item.
  * The operation result has `Successful = true` and will contain the new value and new index.

---

* In this article:  
  * [Update compare-exchange item using a **store operation**](../compare-exchange/update-cmpxchg-item#update-compare-exchange-item-using-a-store-operation)  
  * [Update compare-exchange item using the **Studio**](../compare-exchange/update-cmpxchg-item#update-compare-exchange-item-using-the-studio)  
  * [Syntax](../compare-exchange/update-cmpxchg-item#syntax)   

</Admonition>

---

## Update compare-exchange item using a Store operation

<Tabs groupId='languageSyntax'>
<TabItem value="Update_operation" label="Update_operation">
```java
// Get existing value
CompareExchangeValue<User> readResult
  = store.operations().send(
      new GetCompareExchangeValueOperation<>(User.class, "AdminUser"));

readResult.getValue().setAge(readResult.getValue().getAge() + 1);

// Update value
CompareExchangeResult<User> saveResult
  = store.operations().send(
      new PutCompareExchangeValueOperation<>("AdminUser", readResult.getValue(), readResult.getIndex()));

// The save result is successful only if 'index' wasn't changed between the read and write operations
boolean saveResultSuccessful = saveResult.isSuccessful();
```
</TabItem>
</Tabs>

---

## Update compare-exchange item using the Studio

You can update any existing compare-exchange item from the Studio.

![The compare-exchange view](../assets/update-cmpxchg-1.png)

1. Go to **Documents > Compare Exchange**.
2. Click to edit a compare-exchange item.

---

![The compare-exchange view](../assets/update-cmpxchg-2.png)

1. Enter the value.
2. Enter the metadata (optional).
3. Click _Save_ to update the item.

---

## Syntax

**Method**:

<TabItem value="" label="">
```java
public PutCompareExchangeValueOperation(String key, T value, long index)
```
</TabItem>

| Parameter    | Type     | Description                                    |
|--------------|----------|------------------------------------------------|
| **key**      | `String` | The unique identifier in the database scope.   |
| **value**    | `T`      | The value to be saved for the specified _key_. |
| **index**    | `long`   | The current version of the item when updating an existing item. |

**Returned object**:

<TabItem value="" label="">
```java
public class CompareExchangeResult<T> {
  private T value;
  private long index;
  private boolean successful;

  public T getValue() {
      return value;
  }

  public void setValue(T value) {
      this.value = value;
  }

  public long getIndex() {
      return index;
  }

  public void setIndex(long index) {
      this.index = index;
  }

  public boolean isSuccessful() {
      return successful;
  }

  public void setSuccessful(boolean successful) {
      this.successful = successful;
  }
}
```
</TabItem>

| Return Value  | Type      | Description                                                                                                                                       |
|---------------|-----------|---------------------------------------------------------------------------------------------------------------------------------------------------|
| **Successful**| `boolean` | <ul><li>_true_ if the put operation has completed successfully.</li><li>_false_ if the put operation failed.</li></ul>                            |
| **Value**     | `T`       | <ul><li>Upon success - the value of the compare-exchange item that was saved.</li><li>Upon failure - the existing value on the server.</li></ul>  |
| **Index**     | `long`    | <ul><li>Upon success - the updated version (the incremented index of the modified item).</li><li>Upon failure (if indexes do not match) - the existing version from the server.</li></ul> |
