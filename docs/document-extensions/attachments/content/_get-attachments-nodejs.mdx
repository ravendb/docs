import Admonition from '@theme/Admonition';
import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';
import CodeBlock from '@theme/CodeBlock';
import ContentFrame from '@site/src/components/ContentFrame';
import Panel from '@site/src/components/Panel';

<Admonition type="note" title="">

* This article explains how to retrieve attachments that are already stored in the database.  
    
* In this article
  * [Get attachment via the session](../../document-extensions/attachments/get-attachments#get-attachment-via-the-session)  
  * [Get attachment via an operation](../../document-extensions/attachments/get-attachments#get-attachment-via-an-operation) 
 
</Admonition>

<Panel heading="Get attachment via the session">
    
There are a few methods that allow you to download attachments from a database:   

**session.advanced.attachments.get()** can be used to download an attachment.   
**session.advanced.attachments.getNames()** can be used to download all attachment names that are attached to a document.   
**session.advanced.attachments.getRevision()** can be used to download an attachment of a revision document.   
**session.advanced.attachments.exists()** can be used to determine if an attachment exists on a document.   

### Syntax

<TabItem value="GetSyntax" label="GetSyntax">
<CodeBlock language="js">
{`session.advanced.attachments.getNames(entity);

session.advanced.attachments.exists(documentId, name);

session.advanced.attachments.get(documentId, name);

session.advanced.attachments.get(entity, name);

session.advanced.attachments.getRevision(documentId, name, changeVector);
`}
</CodeBlock>
</TabItem>

| Parameters | | |
| ------------- | ------------- | ----- |
| **entity** or **documentId** | object or string | instance of the entity or the entity ID |
| **name** | string | attachment name |
| **changeVector** | string | change vector for revision identification |

| Return Value | |
| ------------- | ------------- |
| `Promise<AttachmentStreamResult>` | Promise resolving to a Readable for attachment content |

### Example

<TabItem value="GetAttachment" label="GetAttachment">
<CodeBlock language="js">
{`const album = await session.load("albums/1");

const file1 = await session.advanced.attachments.get(album, "001.jpg");
const file2 = await session.advanced.attachments.get("albums/1", "002.jpg");

const inputStream = file1.data;

const attachmentDetails = file1.details;
//     \{ 
//       name: '001.jpg',
//       documentId: 'albums/1',
//       contentType: 'image/jpeg',
//       hash: 'MvUEcrFHSVDts5ZQv2bQ3r9RwtynqnyJzIbNYzu1ZXk=',
//       changeVector: '"A:3-K5TR36dafUC98AItzIa6ow"',
//       size: 25793 
//     \}

const attachmentNames = await session.advanced.attachments.getNames(album);
for (const attachmentName of attachmentNames) \{
    const name = attachmentName.name;
    const contentType = attachmentName.contentType;
    const hash = attachmentName.hash;
    const size = attachmentName.size;
\}

const exists = session.advanced.attachments.exists("albums/1", "003.jpg");
// true

`}
</CodeBlock>
</TabItem>

</Panel>

<Panel heading="Get attachment via an operation">
    
### Get attachment example

<TabItem value="get_attachment" label="get_attachment">
<CodeBlock language="js">
{`// Define the get attachment operation
const getAttachmentOp = new GetAttachmentOperation("employees/1-A", "attachmentName.txt", "Document", null);

// Execute the operation by passing it to operations.send
const attachmentResult = await documentStore.operations.send(getAttachmentOp);

// Retrieve attachment content:
attachmentResult.data
    .pipe(fs.createWriteStream("attachment"))
    .on("finish", () => \{
        fs.readFile("attachment", "utf8", (err, data) => \{
            if (err) \{
                console.error("Error reading file:", err);
                return;
            \}
            console.log("Content of attachment:", data);
            next();
        \});
    \});
`}
</CodeBlock>
</TabItem>

### Syntax

<TabItem value="syntax_1" label="syntax_1">
<CodeBlock language="js">
{`const getAttachmentOp = new GetAttachmentOperation(documentId, name, type, changeVector);
`}
</CodeBlock>
</TabItem>

| Parameter        | Type     | Description                                                                                                                                                                                               |
|------------------|----------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| **documentId**   | `string` | Document ID that contains the attachment.                                                                                                                                                                 |
| **name**         | `string` | Name of attachment to get.                                                                                                                                                                                |
| **type**         | `string` | Specify whether getting an attachment from a document or from a revision.<br/>(`"Document"` or `"Revision"`).                                                                                              |
| **changeVector** | `string` | The ChangeVector of the document or the revision to which the attachment belongs.<br/>Mandatory when getting an attachment from a revision.<br/>Used for concurrency checks (use `null` to skip the check). |

| Return Value of `store.operations.send(getAttachmentOp)`  |                                         |
|-----------------------------------------------------------|-----------------------------------------|
| `AttachmentResult`                                        | An instance of class `AttachmentResult` |

<TabItem value="syntax_2" label="syntax_2">
<CodeBlock language="js">
{`class AttachmentResult \{
    data;    // Stream containing the attachment content
    details; // The AttachmentDetails object
\}

// The AttachmentDetails object:
// =============================
\{
    // Change vector of the document that contains the attachment
    changeVector; // string

    // ID of the document that contains the attachment
    documentId?; // string
    
    // Name of attachment
    name; // string;
    
    // Hash of attachment
    hash; // string;
    
    // Content type of attachment
    contentType; // string
    
    // Size of attachment
    size; // number
\}
`}
</CodeBlock>
</TabItem>    
    
</Panel>