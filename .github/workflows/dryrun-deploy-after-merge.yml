name: Deploy to S3 after merge to new-docs

on:
  push:
    branches: [new-docs]

jobs:
  deploy:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'
          cache: 'npm'
          
      - name: Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.x'
          
      - name: Install dependencies
        run: npm ci --no-audit --fund false
        
      - name: Run deployment script
        shell: pwsh
        env:
          WHATS_NEW_URL: ${{ secrets.WHATS_NEW_URL }}
          AWS_ACCESS_KEY_ID: FAKEKEYID
          AWS_SECRET_ACCESS_KEY: FAKEACCESSKEY
          AWS_DEFAULT_REGION: us-east-1
        run: |
          scripts/deploy.ps1 -DryRun -Versions "6.2,7.1" -CloudFrontDistributionId "FAKEDISTID" -S3BucketName "FAKEBUCKET"